<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#375EAB" />

		<title>awwan</title>
		<link rel="stylesheet" href="_docs/style.css" />
	</head>
	<body>
		<div class="topbar">
			<div class="container">
				<div class="top-heading">
					<a href="/">awwan</a>
				</div>
				<div class="menu">
					<a
href="https://pkg.go.dev/github.com/shuLhan/awwan">GoDoc</a>
				</div>
			</div>
		</div>

		<div class="page">
			<div class="container">
				<h1>awwan</h1>
				<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_name">NAME</a></li>
<li><a href="#_synopsis">SYNOPSIS</a></li>
<li><a href="#_description">DESCRIPTION</a>
<ul class="sectlevel2">
<li><a href="#_background">BACKGROUND</a></li>
<li><a href="#_the_command">THE COMMAND</a></li>
<li><a href="#_the_script">THE SCRIPT</a></li>
<li><a href="#_environment_file">ENVIRONMENT FILE</a></li>
</ul>
</li>
<li><a href="#_templating">TEMPLATING</a></li>
<li><a href="#_example">EXAMPLE</a></li>
<li><a href="#_faq">FAQ</a>
<ul class="sectlevel2">
<li><a href="#_workspace_structure">Workspace structure</a></li>
<li><a href="#_what_happened_if_two_variables_declared_inside_two_environment_files">What happened if two variables declared inside two environment files?</a></li>
</ul>
</li>
<li><a href="#_todo">TODO</a></li>
<li><a href="#_bugs">BUGS</a></li>
<li><a href="#_license">LICENSE</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="https://img.shields.io/badge/go.dev-reference-007d9c?logo=go&logoColor=white&style=flat-square" alt="GoDoc"></span>
<span class="image"><img src="https://goreportcard.com/badge/github.com/shuLhan/awwan" alt="Go Report Card"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_name">NAME</h2>
<div class="sectionbody">
<div class="paragraph">
<p>awwan - advanced remote execution program</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_synopsis">SYNOPSIS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>awwan &lt;command&gt; &lt;script&gt; [line-start] [line-end | &#34;-&#34;]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_description">DESCRIPTION</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>awwan</code> is command line interface to execute multiple lines of command in
the local or remote server using SSH.</p>
</div>
<div class="sect2">
<h3 id="_background">BACKGROUND</h3>
<div class="paragraph">
<p>Do you have a collection of shell scripts to manage one more similar server?
Do you ever want to execute only part of your script?
Are you get tired with learning others syntax and tools for provisioning
your own server, while you need is a handful of shell script?</p>
</div>
<div class="paragraph">
<p>If yes, awwan is the right tools for you.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_command">THE COMMAND</h3>
<div class="paragraph">
<p>awwan only need four arguments, the first two are required, the rest is
optional.</p>
</div>
<div class="paragraph">
<p>The first two required arguments are the mode and the path to script to be
executed.
The last optional arguments are the line start and line end number.</p>
</div>
<div class="paragraph">
<p>The first argument is mode.
Its currently only have two values: &#34;local&#34; or &#34;play&#34;.
The &#34;local&#34; mode execute the script in local environment, your own machine,
without using SSH.
The &#34;play&#34; mode execute the script in remote environment, your SSH server.</p>
</div>
<div class="paragraph">
<p>The second argument is the path to the awwan script file.</p>
</div>
<div class="paragraph">
<p>The third, optional, argument is line start number.
Its define the line number in the script where awwan will start
execution.
If not defined, default to 1, start from the first line.</p>
</div>
<div class="paragraph">
<p>The fourth, optional, argument is the line end number or &#34;-&#34; to set to the
last line.
Its define the line number in the script where awwan will stop executing the
script.
If not defined that it will be equal to the line start, which means awwan will
execute only single line.
Another value for this argument is &#34;-&#34;, its means execute the script from
line-start until the last line.</p>
</div>
<div class="paragraph">
<p>Here is some examples of how to execute awwan.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute the first line of &#34;script.sh&#34; in local system.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ awwan local path/to/script.sh</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute only line 5 of &#34;script.sh&#34; on remote server,</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ awwan play path/to/script.sh 5</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute line 5 until line 10 of &#34;script.sh&#34; on remote server,</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ awwan play path/to/script.sh 5 10</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Execute line 5 until last line of &#34;script.sh&#34; on remote server,</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>$ awwan play path/to/script.sh 5 -</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_script">THE SCRIPT</h3>
<div class="paragraph">
<p>The awwan script is similar to shell script.
Each line started with &#39;#&#39; is a comment, except for special, magic words.</p>
</div>
<div class="paragraph">
<p>There are three magic words in the script: <code>#get:</code>, <code>#put:</code>, and <code>#put!</code>.</p>
</div>
<div class="paragraph">
<p>Magic word <code>#get:</code> will copy file from remote server to your local file
system.
Example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#get: /etc/os-release os-release</pre>
</div>
</div>
<div class="paragraph">
<p>Magic word <code>#put:</code> will copy file from your local to remote server.
Example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#put: /etc/locale.conf /tmp/locale.conf</pre>
</div>
</div>
<div class="paragraph">
<p>Magic word <code>#put!</code> will copy file from your local system to remote server
using sudo.
Example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#put! /etc/locale.conf /etc/locale.conf</pre>
</div>
</div>
<div class="paragraph">
<p>One thing that script can&#39;t do is piping, for example &#34;a &gt; b&#34; does not work,
yet.</p>
</div>
<div class="paragraph">
<p>Here is an example of script that install Nginx on remote Arch Linux server
using configuration from your local computer,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo pacman -Sy --noconfirm nginx
sudo systemctl enable nginx

#put! {{.ScriptDir}}/etc/nginx/nginx.conf /etc/nginx/

sudo systemctl restart nginx
sudo systemctl status nginx</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_environment_file">ENVIRONMENT FILE</h3>
<div class="paragraph">
<p>The environment file is a file named <code>awwan.env</code> that contains key-to-value
that can be used for templating.</p>
</div>
<div class="paragraph">
<p>When executing the script, <code>awwan</code> will read environment files in the current
directory and in the script directory.</p>
</div>
<div class="paragraph">
<p>The environment file use the ini file format,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[section &#34;subsection&#34;]
key = value</pre>
</div>
</div>
<div class="paragraph">
<p>Currently, there are only one required section in environment file that
<code>awwan</code> need: &#34;ssh&#34;, so awwan can know the host, user, and port number of
remote server.
You must put the <code>awwan.env</code> in your script.</p>
</div>
<div class="paragraph">
<p>Example of environment file,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ssh]
host = 1.2.3.4
user = arch
port = 2222</pre>
</div>
</div>
<div class="paragraph">
<p>Beside that, you can put as many sections or any variables inside the file.</p>
</div>
<div class="paragraph">
<p>We will explain how to use and get the environment variables below.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_templating">TEMPLATING</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Template file is any text or script files that dynamically generated using
values from variables defined in environment files.</p>
</div>
<div class="paragraph">
<p>There are two global variables that shared to all template or script files,</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>.BaseDir</code> contains the absolute path of current directory, and</p>
</li>
<li>
<p><code>.ServiceDir</code> contains the relative path to script directory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To get the value wrap the variable using &#39;{{}}&#39; for example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#put! {{.BaseDir}}/templates/etc/hosts /etc/
#put! {{.ServiceDir}}/etc/hosts /etc/</pre>
</div>
</div>
<div class="paragraph">
<p>To get the value of variable in environment file you put the string &#34;.Val&#34;
followed by section, subsection and key names, each separated by colon &#34;:&#34;.
If no subsection exist you can leave it empty.</p>
</div>
<div class="paragraph">
<p>You can put the variable inside the script or in the file that you want to
copy.</p>
</div>
<div class="paragraph">
<p>For example, given the following environment file,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ssh]
host = 1.2.3.4
user = arch
port = 2222

[whitelist &#34;ip&#34;]
alpha = 1.2.3.4/32
beta  = 2.3.4.5/32</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{{.Val &#34;ssh::host&#34;}}</code> will result &#34;1.2.3.4&#34; (without double quote), and</p>
</li>
<li>
<p><code>{{.Val &#34;whitelist:ip:alpha&#34;}}</code> will result to &#34;1.2.3.4/32&#34; (without double quote)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example">EXAMPLE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let say that we have the working remote server at IP address &#34;1.2.3.4&#34; using
username &#34;arch&#34; on port &#34;2222&#34; in the following environment file,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ssh]
host = 1.2.3.4
user = arch
port = 2222

[whitelist &#34;ip&#34;]
alpha = 1.2.3.4/32
beta  = 2.3.4.5/32</pre>
</div>
</div>
<div class="paragraph">
<p>and script file &#34;test.aww&#34;,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>echo {{.Val &#34;ssh::host&#34;}}`
#put: {{.ScriptDir}}/test /tmp/
cat /tmp/test</pre>
</div>
</div>
<div class="paragraph">
<p>and a template file &#34;test&#34;,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hi {{.Val &#34;ssh::user&#34;}}!</pre>
</div>
</div>
<div class="paragraph">
<p>When executed, it will print the following output to terminal,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ awwan play test.aww 1 -
&gt;&gt;&gt; arch@1.2.3.4:22: 1: echo 1.2.3.4

1.2.3.4
test                                                  100%    9     0.4KB/s   00:00
&gt;&gt;&gt; arch@1.2.3.4:22: 3: cat /tmp/test

Hi arch!
</pre>
</div>
</div>
<div class="paragraph">
<p>That&#39;s it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faq">FAQ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since this software is working in progress, there are many things that we have
in mind, but can&#39;t put it yet on code.</p>
</div>
<div class="sect2">
<h3 id="_workspace_structure">Workspace structure</h3>
<div class="paragraph">
<p><code>awwan</code> did not require any special directory but we really recommend that you
use sub directory to group several nodes on several cloud services.
For example, if you use cloud services with several nodes inside it, we
recommend the following directory structures,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;cloud-service&gt;/&lt;project-name&gt;/&lt;service-name&gt;/&lt;node-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;cloud-service&gt;</code> is the name of your remote server, it could be &#34;AWS&#34;,
&#34;GCP&#34;, &#34;DO&#34;, and others.
The <code>&lt;project-name&gt;</code> is your account ID in your cloud service or your project
name.
The <code>&lt;service-name&gt;</code> is a group of several nodes, for example &#34;development&#34;,
&#34;staging&#34;, &#34;production&#34;.
The <code>&lt;node-name&gt;</code> is name of your node, each node should have one single
directory.</p>
</div>
<div class="paragraph">
<p>Here is an example of my directory structures,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── commons
├── gcp
│   ├── development
│   │   └── vm
│   │       ├── www
│   │       │   └── etc
│   │       │       ├── my.cnf.d
│   │       │       ├── nginx
│   │       │       ├── php
│   │       │       │   └── php-fpm.d
│   │       │       └── systemd
│   │       │           └── system
│   │       │               └── mariadb.service.d
│   │       └── ci
│   └── production
│       └── vm
│           └── stok
│               └── etc -&gt; ../../../playground/vm/tokenomy-stix/etc
└── templates
    ├── etc
    │   ├── pacman.d
    │   └── ssh
    └── home</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>commons</code> directory contains common script that can be executed in any
nodes.</p>
</div>
<div class="paragraph">
<p>The <code>templates</code> directory contains common templates that can be used in any
nodes.</p>
</div>
<div class="paragraph">
<p>The <code>gcp</code> directory is cloud service with two accounts &#34;development&#34; and
&#34;production&#34;, and the rest are node names and templates used in that node.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_happened_if_two_variables_declared_inside_two_environment_files">What happened if two variables declared inside two environment files?</h3>
<div class="paragraph">
<p>When executing the script <code>awwan</code> will merge the variables from current
directory with variable from script directory.
Any keys that are duplicate will be merged and the last one will overwrite the
previous one.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_todo">TODO</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Allow each sub-directory to contains environment file.
For example, given the above workspace example, we can have <code>awwan.env</code> in
root directory, in <code>gcp</code>, <code>development</code>, <code>production</code>, <code>vm</code>, and so on until
the location of the script file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bugs">BUGS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Shell pipe &#34;|&#34;, &#34;&lt;&#34;, or &#34;&gt;&#34;  does not work in script, yet.</p>
</div>
<div class="paragraph">
<p>For request of features and/or bugs report please submitted through web at
<a href="https://github.com/shuLhan/awwan/issues." class="bare">https://github.com/shuLhan/awwan/issues.</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license">LICENSE</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre>Copyright (c) 2020 M. Shulhan (m.shulhan@gmail.com). All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

   * Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.
   * Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following disclaimer
in the documentation and/or other materials provided with the
distribution.
   * Neither the name of M. Shulhan, nor the names of its
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
&#34;AS IS&#34; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</pre>
</div>
</div>
</div>
</div>
			</div>
			
		</div>
		

		<div class="footer">
			Copyright 2019, Shulhan &lt;ms@kilabit.info&gt;. All rights reserved.
			<br />
			Use of this source code is governed by a BSD-style license that can be
			found in the <a href="/LICENSE">LICENSE</a> file.
		</div>
	</body>
</html>
